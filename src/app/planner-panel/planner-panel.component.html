<leaflet-map #leafletMap
             (fromSelected)="onLocationPicked($event, true)"
             (toSelected)="onLocationPicked($event, false)"
             (fromMoved)="onLocationPicked($event, true)"
              (toMoved)="onLocationPicked($event, false)"
>
</leaflet-map>

<div class="planner-panel">
  <div class="panel-header">
    <h2>Zaplanuj podróż</h2>
  </div>
  <form [formGroup]="form">

    <city-autocomplete
      label="Początek trasy"
      placeholder="Wybierz miasto początkowe"
      [control]="fromFormControl"
      [cityOptions$]="filteredFromCities$"
      (optionSelected)="handleCitySelected($event, 'from')">
    </city-autocomplete>

    <span formArrayName="middlePoints">
      <ng-container *ngFor="let ctrl of middlePointsFormArray.controls; let i = index">
        <div class="middle-point-row">
          <city-autocomplete
            [label]="'Punkt pośredni ' + (i + 1)"
            placeholder="Wybierz miasto pośrednie"
            [control]="ctrl"
            [cityOptions$]="filteredMiddlePointCities$[i]"
            (optionSelected)="handleCitySelected($event, 'middle')">
          </city-autocomplete>
          <button mat-icon-button
                  class="middle-point-remove-btn"
                  (click)="removeMiddlePointForm(i)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </ng-container>
    </span>

    <div class="add-middle-point-btn-wrapper">
    <button mat-button (click)="addMiddlePointForm()">Dodaj punkt pośredni
        <mat-icon>add</mat-icon>
    </button>
    </div>

    <city-autocomplete
      label="Koniec trasy"
      placeholder="Wybierz miasto końcowe"
      [control]="toFormControl"
      [cityOptions$]="filteredToCities$"
      (optionSelected)="handleCitySelected($event, 'to')">
    </city-autocomplete>

  <div class="panel-actions">
    <button mat-raised-button color="primary" (click)="findRoute()" >Znajdź trasę</button>
  </div>
  </form>
</div>
